<!DOCTYPE html>
<html>
<head>
  <title>Location Attendance</title>
</head>
<body>
  <h2>Mark Attendance</h2>
  <button onclick="markAttendance()">Mark Attendance</button>
  <p id="status"></p> 

  <script>
    // Allowed Location (example: office/school coordinates)
const allowedLat = 11.0251;
const allowedLon = 77.0176;

 
    const allowedRadius = 300;   // meters

    // Haversine Formula - calculate distance between two points
    function getDistanceFromLatLonInMeters(lat1, lon1, lat2, lon2) {
      const R = 6371e3; // Radius of Earth in meters
      const φ1 = lat1 * Math.PI/180;
      const φ2 = lat2 * Math.PI/180;
      const Δφ = (lat2-lat1) * Math.PI/180;
      const Δλ = (lon2-lon1) * Math.PI/180;

      const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                Math.cos(φ1) * Math.cos(φ2) *
                Math.sin(Δλ/2) * Math.sin(Δλ/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

      return R * c; // distance in meters
    }

    function markAttendance() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const userLat = position.coords.latitude;
            const userLon = position.coords.longitude;

            const distance = getDistanceFromLatLonInMeters(userLat, userLon, allowedLat, allowedLon);

            if (distance <= allowedRadius) {
              document.getElementById("status").innerHTML = "✅ Attendance Marked Successfully!";
            } else {
              document.getElementById("status").innerHTML = "❌ You are outside the allowed area (" + Math.round(distance) + "m away)";
            }
          },
          (error) => {
            document.getElementById("status").innerHTML = "Error: " + error.message;
          }
        );
      } else {
        document.getElementById("status").innerHTML = "Geolocation is not supported by this browser.";
      }

      //console.log("Your Location:", userLat, userLon);
console.log("Allowed Location:", allowedLat, allowedLon);
//console.log("Distance:", distance);

    }
  </script>
</body>
</html>
